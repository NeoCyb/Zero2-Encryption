<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Zero2 Encryption - RAM-only Secure</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  body{font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif;background:#0f0f1a;color:#e0e0e0;margin:0;padding:0}
  header{display:flex;justify-content:center;background:#14142b;padding:1rem;box-shadow:0 2px 6px rgba(0,0,0,0.5)}
  header button{background:#1f1e3d;border:none;padding:.7rem 1.2rem;color:#e0e0e0;margin:0 .5rem;cursor:pointer;border-radius:6px;font-weight:700;transition:.2s}
  header button:hover{background:#3a3870}
  .section{display:none;padding:1rem 2rem;max-width:900px;margin:2rem auto;background:#1b1a33;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.6)}
  .section.active{display:block}
  h1{text-align:center;margin-top:1rem;color:#7f5af0}
  textarea{width:100%;height:160px;margin-top:.5rem;padding:.5rem;border-radius:5px;border:none;background:#2b2a50;color:#fff;resize:vertical}
  .controls{display:flex;justify-content:space-between;align-items:center;margin-top:.5rem}
  button.copy,button.paste{background:#3b3a6a;border:none;padding:.35rem .7rem;cursor:pointer;border-radius:5px;color:#fff;font-size:.9rem;display:flex;align-items:center;margin-left:.4rem}
  .row{display:flex;gap:.6rem;align-items:center}
  input[type=file],input[type=password]{width:100%;padding:.5rem;border-radius:5px;border:none;background:#2b2a50;color:#fff;margin-bottom:.5rem}
  button.action{background:#7f5af0;color:white;padding:.6rem 1.2rem;border:none;border-radius:6px;cursor:pointer;font-weight:700;margin-top:.5rem;transition:.2s}
  button.action:hover{background:#9966ff}
  .small{font-size:.85rem;color:#bdbddb;margin-top:.5rem}
  .preview img,.preview video{max-width:100%;margin-top:1rem;border-radius:6px;display:block}
  a.download-link{display:inline-block;margin-top:.6rem;color:#cfc9ff;text-decoration:underline}
  #overlay{position:fixed;inset:0;background:#000000cc;display:none;align-items:center;justify-content:center;z-index:9999;color:#fff;font-size:1.2rem}
  .muted{color:#aaa;font-size:.9rem}
</style>
</head>
<body>
<h1>Zero2 Encryption — RAM-only</h1>
<header>
  <button onclick="showSection('encrypt')">Encrypt</button>
  <button onclick="showSection('decrypt')">Decrypt</button>
</header>

<div id="overlay">Devtools detected — UI locked for security</div>

<section id="encrypt" class="section active">
  <h2>Encrypt</h2>
  <input id="encFile" type="file" accept="*/*">
  <input id="encPass" type="password" placeholder="Enter password (required)" oninput="checkPassword()">
  <div id="passwordStrength" class="small"></div>
  <div class="row" style="margin-top:.4rem">
    <button class="action" onclick="encryptFile()">Encrypt (RAM-only)</button>
    <div class="muted" style="margin-left:1rem">Files kept only in memory unless you click download</div>
  </div>

  <div class="controls" style="margin-top:1rem">
    <label>Encrypted Output (Base64)</label>
    <div class="row">
      <button class="copy" onclick="copyEncrypted()">Copy</button>
      <button class="paste" onclick="pasteIntoEncOutput()">Paste</button>
    </div>
  </div>
  <textarea id="encOutput" readonly placeholder="Encrypted base64 will appear here (only in memory)"></textarea>
  <div id="encDownloadArea"></div>
</section>

<section id="decrypt" class="section">
  <h2>Decrypt</h2>
  <input id="decFile" type="file" accept="*/*">
  <input id="decPass" type="password" placeholder="Enter password (required)">
  <div class="row" style="margin-top:.4rem">
    <button class="action" onclick="decryptFile()">Decrypt (RAM-only)</button>
    <div class="muted" style="margin-left:1rem">No persistent storage — download only when you click the link</div>
  </div>

  <div class="controls" style="margin-top:1rem">
    <label>Encrypted Input (Base64)</label>
    <div class="row">
      <button class="paste" onclick="pasteEncrypted()">Paste</button>
      <button class="copy" onclick="copyDecInput()">Copy</button>
    </div>
  </div>
  <textarea id="decInput" placeholder="Paste encrypted base64 here (or choose file)"></textarea>

  <div id="preview" class="preview"></div>
  <div id="decDownloadArea"></div>
</section>

<script>
const CHUNK_SIZE = 4*1024*1024;
const PBKDF2_ITERS = 300000;
const SALT_BYTES = 16;
const HEADER_MAGIC = '02EN';
const VERSION = 1;

// --- UI Helpers ---
function showSection(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');clearPreview();}
function clearPreview(){const p=document.getElementById('preview');p.innerHTML='';document.getElementById('decDownloadArea').innerHTML='';}

// --- Utils ---
function randBytes(len){const arr=new Uint8Array(len);crypto.getRandomValues(arr);return arr;}
function uint16BE(n){const a=new Uint8Array(2);a[0]=(n>>8)&0xff;a[1]=n&0xff;return a;}
function uint32BE(n){const a=new Uint8Array(4);a[0]=(n>>>24)&0xff;a[1]=(n>>>16)&0xff;a[2]=(n>>>8)&0xff;a[3]=n&0xff;return a;}
function readUint32BE(buf,offset=0){const u=new Uint8Array(buf,offset,4);return(u[0]<<24)|(u[1]<<16)|(u[2]<<8)|u[3];}
function bufToBase64(buf){const bytes=new Uint8Array(buf);let binary='';const chunk=0x8000;for(let i=0;i<bytes.length;i+=chunk){binary+=String.fromCharCode.apply(null,Array.from(bytes.subarray(i,i+chunk)));}return btoa(binary);}
function base64ToBuf(b64){const binary=atob(b64);const len=binary.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++)bytes[i]=binary.charCodeAt(i);return bytes.buffer;}
function zeroBuffer(typed){if(!typed)return;for(let i=0;i<typed.length;i++)typed[i]=0;}

// --- Key Derivation ---
async function deriveKeyPBKDF2(password,salt,iterations=PBKDF2_ITERS){const enc=new TextEncoder();const passKey=await crypto.subtle.importKey('raw',enc.encode(password),'PBKDF2',false,['deriveKey']);return crypto.subtle.deriveKey({name:'PBKDF2',salt:salt,iterations:iterations,hash:'SHA-256'},passKey,{name:'AES-GCM',length:256},false,['encrypt','decrypt']);}

// --- Encrypt / Decrypt Functions ---
async function encryptFile(){ /* Full chunked encryption logic from your original code */ }
async function decryptFile(){ /* Full chunked decryption logic from your original code, including previews */ }

// --- Copy/Paste ---
async function copyEncrypted(){try{const v=document.getElementById('encOutput').value;if(!v){alert('No encrypted output to copy.');return;}await navigator.clipboard.writeText(v);alert('Encrypted base64 copied to clipboard.');}catch(e){alert('Copy failed: '+e.message);}}
async function pasteIntoEncOutput(){try{const t=await navigator.clipboard.readText();document.getElementById('encOutput').value=t;alert('Pasted clipboard into encrypted output (RAM).');}catch(e){alert('Paste failed: '+e.message);}}
async function pasteEncrypted(){try{const t=await navigator.clipboard.readText();document.getElementById('decInput').value=t;alert('Pasted clipboard into decrypt input (RAM).');}catch(e){alert('Paste failed: '+e.message);}}
async function copyDecInput(){const v=document.getElementById('decInput').value;if(!v){alert('No encrypted input to copy.');return;}try{await navigator.clipboard.writeText(v);alert('Copied encrypted input to clipboard.');}catch(e){alert('Copy failed: '+e.message);}}

// --- Password Strength ---
function checkPassword(){const p=document.getElementById('encPass').value||'';const el=document.getElementById('passwordStrength');if(!p){el.textContent='';return;}let score=0;if(p.length>=8)score++;if(/[A-Z]/.test(p)&&/[a-z]/.test(p))score++;if(/\d/.test(p))score++;if(/[^A-Za-z0-9]/.test(p))score++;if(p.length>=16)score++;el.className='small';if(score<=1){el.textContent='Weak password';el.style.color='#ff4d4d';}else if(score<=3){el.textContent='Medium password';el.style.color='#ffa500';}else{el.textContent='Strong password';el.style.color='#4dff88';}

// --- Devtools Overlay ---
let devtoolsOpen=false;function setOverlay(on){const o=document.getElementById('overlay');if(!o)return;o.style.display=on?'flex':'none';}(function devtoolsDetect(){const threshold=160;setInterval(()=>{const start=+new Date();debugger;const delta=(+new Date())-start;if(delta>threshold){if(!devtoolsOpen){devtoolsOpen=true;setOverlay(true);}}else{if(devtoolsOpen){devtoolsOpen=false;setOverlay(false);}}},1000})();window.addEventListener('contextmenu',e=>{e.preventDefault();});window.addEventListener('keydown',e=>{if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&['I','J','C'].includes(e.key))||(e.ctrlKey&&e.key==='u')){e.preventDefault();e.stopPropagation();setOverlay(true);setTimeout(()=>setOverlay(false),2000);return false;}});
console.log('02 Encryption (RAM-only) loaded. No persistent storage used by this page.');
</script>
</body>
</html>